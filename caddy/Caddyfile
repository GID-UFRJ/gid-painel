# Use a variável de ambiente para o domínio
{$CADDY_DOMAIN} {
    # Configura o proxy reverso para o serviço Django
    reverse_proxy {$DJANGO_HOST}:{$DJANGO_PORT}

    # Serve arquivos estáticos diretamente do volume compartilhado
    handle /static/* {
        root * /app/staticfiles
        file_server
    }

    # GERENCIAMENTO DE TLS (HTTPS)
    #
    # Caddy irá tentar automaticamente Let's Encrypt se {$CADDY_DOMAIN} for um domínio público
    # e acessível (portas 80/443 abertas).
    # Se for localhost, um IP, ou não conseguir Let's Encrypt, Caddy usará tls internal automaticamente.
    #
    # É uma boa prática informar um e-mail para Let's Encrypt:
    tls {$CADDY_EMAIL} # Caddy usará este email para notificações de Let's Encrypt

    # Compressão
    encode gzip zstd

    # Logs
    log {
        output stdout
        format json
    }
}
